import 'package:platonic/providers/error_provider/create_flat/step2_error_provider.dart';
import 'package:platonic/screens/create_flat_screen/step1_screen/widgets/widgets.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:platonic/screens/error_dialog/error_dialog/error_dialog.dart';
import 'package:flutter_gen/gen_l10n/app_localizations.dart';
import 'package:flutter/material.dart';
import 'widgets/widgets.dart';

/* Frame step2
    Autogenerated by FlutLab FTF Generator
  */
class Step2Screen extends ConsumerStatefulWidget {
  const Step2Screen({super.key});

  @override
  Step2ScreenState createState() => Step2ScreenState();
}

class Step2ScreenState extends ConsumerState<Step2Screen> {
  final formKey = GlobalKey<FormState>();

  @override
  Widget build(BuildContext context) {
    final step2ErrorState = ref.watch(step2ErrorProvider);

    void toggleRoomPreferencesForm() {
      if (formKey.currentState!.validate()) {
        formKey.currentState!.save();

        Navigator.pushNamed(context, '/Step3Screen');
      }
    }

    WidgetsBinding.instance.addPostFrameCallback((_) {
      if (step2ErrorState != null) {
        showDialog(
            context: context,
            builder: (context) => ErrorDialog(
                  error: step2ErrorState.code,
                ));

        ref.read(step2ErrorProvider.notifier).state = null;
      }
    });

    return Scaffold(
        backgroundColor: const Color.fromARGB(255, 27, 26, 29),
        body: SafeArea(
          child: SingleChildScrollView(
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    NavigateBefore(
                      color: Colors.white,
                      title: AppLocalizations.of(context)!.step2NavigatorTitle,
                    ),
                    const SizedBox(
                      height: 22.0,
                    ),
                    SizedBox(
                      height: 33.0,
                      child: CreateFlatDetailTitle(
                        title: AppLocalizations.of(context)!.step2Title,
                      ),
                    ),
                    const SizedBox(
                      height: 18.0,
                    ),
                    const SizedBox(
                      height: 30.0,
                      child: CreateCurrencyRow(),
                    ),
                    const SizedBox(
                      height: 16.0,
                    ),
                    SizedBox(
                      height: 216.0,
                      child: RoomPreferences(
                        formKey: formKey,
                      ),
                    ),
                    const SizedBox(
                      height: 32.0,
                    ),
                    const SizedBox(
                      height: 81.0,
                      child: PreferencesSlider(),
                    ),
                    const SizedBox(
                      height: 32.0,
                    ),
                    SizedBox(
                      height: 33.0,
                      child: CreateFlatDetailTitle(
                        title:
                            AppLocalizations.of(context)!.step2RoomTenantsTitle,
                      ),
                    ),
                    const SizedBox(
                      height: 18.0,
                    ),
                    const SizedBox(
                      height: 70.0,
                      child: TenantsNumberSelector(),
                    ),
                    const SizedBox(
                      height: 32.0,
                    ),
                    SizedBox(
                      height: 44.0,
                      child: GestureDetector(
                          onTap: toggleRoomPreferencesForm,
                          child: Container(
                            alignment: Alignment.center,
                            height: 44.0,
                            decoration: BoxDecoration(
                              color: const Color.fromARGB(255, 63, 141, 253),
                              borderRadius: BorderRadius.circular(10.0),
                              boxShadow: const [
                                BoxShadow(
                                  color: Color.fromARGB(63, 0, 0, 0),
                                  offset: Offset(0.0, 4.0),
                                  blurRadius: 4.0,
                                )
                              ],
                            ),
                            child: CreateFlatDetailButtonText(
                                text: AppLocalizations.of(context)!
                                    .step2NextButton),
                          )),
                    ),
                  ]),
            ),
          ),
        ));
  }

  @override
  void dispose() {
    formKey.currentState?.dispose();
    super.dispose();
  }
}
