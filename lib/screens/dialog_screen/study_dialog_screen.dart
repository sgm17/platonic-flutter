import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:platonic/domains/university_repository/university_repository.dart';
import 'package:platonic/providers/dialog_provider/search_bar_provider.dart';
import 'package:platonic/providers/register_detail_provider/register_detail_provider.dart';
import 'package:platonic/providers/university_provider/universities_provider.dart';
import 'package:platonic/screens/settings_screen/widgets/widgets.dart';

import 'widgets/university_dialog/widgets.dart';

/* Frame university_dialog
    Autogenerated by FlutLab FTF Generator
  */
class StudyDialogScreen extends ConsumerWidget {
  const StudyDialogScreen({
    super.key,
  });

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final universitiesList = ref.watch(universitiesProvider);
    final searchBarState = ref.watch(searchBarProvider);

    List<Study> studies = ref.watch(registerDetailProvider).university !=
                null &&
            ref.watch(registerDetailProvider).faculty != null
        ? universitiesList
            .firstWhere((e) =>
                e.university == ref.watch(registerDetailProvider).university)
            .faculties
            .firstWhere((e) =>
                e.convertToFaculty() ==
                ref.watch(registerDetailProvider).faculty)
            .studies
        : [];

    studies = searchBarState.trim().isEmpty
        ? studies
        : studies
            .where((study) =>
                study.name.toLowerCase().contains(searchBarState.toLowerCase()))
            .toList();

    return Scaffold(
        backgroundColor: const Color.fromARGB(255, 27, 26, 29),
        body: SafeArea(
          child: Padding(
            padding: const EdgeInsets.all(16.0),
            child:
                Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
              const SizedBox(
                height: 31.0,
                child: DialogTitle(title: '''Set your study'''),
              ),
              const SizedBox(
                height: 20.0,
              ),
              const SizedBox(
                height: 20.0,
                child: SearchBar(
                  placeholder: '''Search by study''',
                ),
              ),
              const SizedBox(
                height: 32.0,
              ),
              Expanded(
                child: ListView.separated(
                  itemCount: studies.length,
                  separatorBuilder: (context, index) {
                    return const SizedBox(
                      height: 8.0,
                    );
                  },
                  itemBuilder: (context, index) {
                    return GestureDetector(
                      onTap: () =>
                          ref.read(registerDetailProvider.notifier).state = ref
                              .watch(registerDetailProvider)
                              .copyWith(study: studies[index]),
                      child: OptionSelected(
                        isBlue: true,
                        isSelected: studies[index] ==
                            ref.watch(registerDetailProvider).study,
                        name: studies[index].name,
                      ),
                    );
                  },
                ),
              )
            ]),
          ),
        ));
  }
}
